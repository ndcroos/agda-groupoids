{-# OPTIONS --without-K #-}

module Groupoids.Ordinary.Construction.Comma where

open import Groupoids.Common
open import Groupoids.Ordinary.Homomorphism.Boot
open import Groupoids.Ordinary.Universe.Boot

module Comma where
  open Fun‚ÇÄ

  _‚Üì_
    : ‚àÄ {n r}..{‚Ñì‚ÇÄ ‚Ñì‚ÇÅ ‚Ñì‚ÇÇ}
    ‚Üí {A : ùîò n r ‚Ñì‚ÇÄ}
    ‚Üí {B : ùîò n r ‚Ñì‚ÇÅ}
    ‚Üí {V : ùîò n r ‚Ñì‚ÇÇ}
    ‚Üí (F : Fun‚ÇÄ A V)
    ‚Üí (G : Fun‚ÇÄ B V)
    ‚Üí ùîò n r _
  ‚óè [ _‚Üì_ {A = A}{B}{V} F G ]
    =
    T.Œ£ ((A ‚ñ∏) T.‚äó (B ‚ñ∏)) Œª { (a , b) ‚Üí
      V ‚ñ∏ 1 ‚ä¢ ap‚ÇÄ‚ÇÄ F a ‚Üù ap‚ÇÄ‚ÇÄ G b
    }
  ‚óè (‚áá [ _‚Üì_ {A = A}{B}{V} F G ]
    ((a‚ÇÄ , b‚ÇÄ) T.‚ñ∏ f‚ÇÄ)
    ((a‚ÇÅ , b‚ÇÅ) T.‚ñ∏ f‚ÇÅ))
    =
    T.Œ£ ((A ‚ñ∏ 1 ‚ä¢ a‚ÇÄ ‚Üù a‚ÇÅ) T.‚äó (B ‚ñ∏ 1 ‚ä¢ b‚ÇÄ ‚Üù b‚ÇÅ)) Œª { (g , h) ‚Üí
      V ‚ñ∏ 2 ‚ä¢ seq‚ÇÄ V (ap‚ÇÄ‚ÇÅ F g) f‚ÇÅ ‚Üù seq‚ÇÄ V f‚ÇÄ (ap‚ÇÄ‚ÇÅ G h)
    }
  ‚óè (‚áá (‚áá [ _‚Üì_ {‚Ñì‚ÇÇ = ‚Ñì‚ÇÇ}{A = A}{B}{V} F G ]
    ((a‚ÇÄ , b‚ÇÄ) T.‚ñ∏ f‚ÇÄ)
    ((a‚ÇÅ , b‚ÇÅ) T.‚ñ∏ f‚ÇÅ))
    ((Œ±‚ÇÄ , Œ≤‚ÇÄ) T.‚ñ∏ œÜ)
    ((Œ±‚ÇÅ , Œ≤‚ÇÅ) T.‚ñ∏ œà))
    =
    T.‚äî‚áë ‚Ñì‚ÇÇ ((A ‚ñ∏ 2 ‚ä¢ Œ±‚ÇÄ ‚Üù Œ±‚ÇÅ) T.‚äó (B ‚ñ∏ 2 ‚ä¢ Œ≤‚ÇÄ ‚Üù Œ≤‚ÇÅ))
  ‚áá (‚áá (‚áá [ F ‚Üì G ]
    ((a‚ÇÄ , b‚ÇÄ) T.‚ñ∏ f‚ÇÄ)
    ((a‚ÇÅ , b‚ÇÅ) T.‚ñ∏ f‚ÇÅ))
    ((Œ±‚ÇÄ , Œ≤‚ÇÄ) T.‚ñ∏ œÜ)
    ((Œ±‚ÇÅ , Œ≤‚ÇÅ) T.‚ñ∏ œà))
    _
    _
    =
    ùîä.ùüô‚Üë
  ‚Üª (‚áá (‚áá [ F ‚Üì G ]
    ((a‚ÇÄ , b‚ÇÄ) T.‚ñ∏ f‚ÇÄ)
    ((a‚ÇÅ , b‚ÇÅ) T.‚ñ∏ f‚ÇÅ))
    ((Œ±‚ÇÄ , Œ≤‚ÇÄ) T.‚ñ∏ œÜ)
    ((Œ±‚ÇÅ , Œ≤‚ÇÅ) T.‚ñ∏ œà))
    =
    *
  ‚Üª (‚áá [ _‚Üì_ {A = A}{B} F G ]
    ((a‚ÇÄ , b‚ÇÄ) T.‚ñ∏ f‚ÇÄ)
    ((a‚ÇÅ , b‚ÇÅ) T.‚ñ∏ f‚ÇÅ))
    {_}
    {(Œ± , Œ≤) T.‚ñ∏ œÜ}
    =
    Œπ (idn‚ÇÅ A , idn‚ÇÅ B)
  ‚Üª [ _‚Üì_ {A = A}{B}{V} F G ]
    {_}
    {(a‚ÇÄ , b‚ÇÄ) T.‚ñ∏ f‚ÇÄ}
    =
    (idn‚ÇÄ A , idn‚ÇÄ B) T.‚ñ∏
    (seq‚ÇÅ V
      (seq‚ÇÄ*-Œª V (‚ä¢idn F))
      (seq‚ÇÅ V
        (‚ä¢idn‚ÇÄ-Œª V)
        (inv‚ÇÅ V
          (seq‚ÇÅ V
            (seq‚ÇÄ*-œÅ V (‚ä¢idn G))
            (‚ä¢idn‚ÇÄ-œÅ V)))))
  seq‚ÇÄ (_‚Üì_ {A = A}{B}{V} F G)
    {(a‚ÇÄ , b‚ÇÄ) T.‚ñ∏ f‚ÇÄ}{(a‚ÇÅ , b‚ÇÅ) T.‚ñ∏ f‚ÇÅ}{(a‚ÇÇ , b‚ÇÇ) T.‚ñ∏ f‚ÇÇ}
    ((Œ±‚ÇÄ , Œ≤‚ÇÄ) T.‚ñ∏ œÜ)((Œ±‚ÇÅ , Œ≤‚ÇÅ) T.‚ñ∏ œà)
    =
    (seq‚ÇÄ A Œ±‚ÇÄ Œ±‚ÇÅ , seq‚ÇÄ B Œ≤‚ÇÄ Œ≤‚ÇÅ) T.‚ñ∏
    (seq‚ÇÅ V
      (seq‚ÇÄ*-Œª V (‚ä¢seq F))
      (seq‚ÇÅ V
        (inv‚ÇÅ V (‚ä¢seq‚ÇÄ-Œ± V))
        (seq‚ÇÅ V
          (seq‚ÇÄ*-œÅ V œà)
          (seq‚ÇÅ V
            (‚ä¢seq‚ÇÄ-Œ± V)
            (seq‚ÇÅ V
              (seq‚ÇÄ*-Œª V œÜ)
              (seq‚ÇÅ V
                (inv‚ÇÅ V (‚ä¢seq‚ÇÄ-Œ± V))
                (seq‚ÇÄ*-œÅ V (inv‚ÇÅ V (‚ä¢seq G)))))))))
  inv‚ÇÄ (_‚Üì_ {A = A}{B}{V} F G)
    -- {(a‚ÇÄ , b‚ÇÄ) T.‚ñ∏ f‚ÇÄ}{(a‚ÇÅ , b‚ÇÅ) T.‚ñ∏ f‚ÇÅ}
    ((Œ±‚ÇÄ , Œ≤‚ÇÄ) T.‚ñ∏ œÜ)
    {‚âú}
    =
    (inv‚ÇÄ A Œ±‚ÇÄ {‚âú} , inv‚ÇÄ B Œ≤‚ÇÄ {‚âú}) T.‚ñ∏
    seq‚ÇÅ V
      (inv‚ÇÅ V (‚ä¢idn‚ÇÄ-œÅ V))
      (seq‚ÇÅ V
        (seq‚ÇÄ*-œÅ V (inv‚ÇÅ V (‚ä¢inv‚ÇÄ-œÅ V {f = ap‚ÇÄ‚ÇÅ G Œ≤‚ÇÄ})))
        (seq‚ÇÅ V
          (inv‚ÇÅ V (‚ä¢seq‚ÇÄ-Œ± V))
          (seq‚ÇÅ V
            (seq‚ÇÄ*-œÅ V
              (seq‚ÇÅ V
                (‚ä¢seq‚ÇÄ-Œ± V)
                (seq‚ÇÄ*-Œª V (inv‚ÇÅ V œÜ))))
            (seq‚ÇÅ V
              (‚ä¢seq‚ÇÄ-Œ± V)
              (seq‚ÇÅ V
                (seq‚ÇÄ*-Œª V
                  (seq‚ÇÅ V
                    (‚ä¢seq‚ÇÄ-Œ± V)
                    (seq‚ÇÅ V
                      (seq‚ÇÄ*-Œª V
                        (seq‚ÇÅ V
                          (inv‚ÇÅ V (‚ä¢seq F))
                          (seq‚ÇÅ V
                            (ap‚ÇÄ‚ÇÇ F (‚ä¢inv‚ÇÄ-Œª A))
                            (‚ä¢idn F))))
                      (‚ä¢idn‚ÇÄ-Œª V))))
                (seq‚ÇÄ*-œÅ V (inv‚ÇÅ V (‚ä¢inv G))))))))
  seq‚ÇÄ* (_‚Üì_ {A = A}{B}{V} F G)
    -- {(a‚ÇÄ , b‚ÇÄ) T.‚ñ∏ f‚ÇÄ}{(a‚ÇÅ , b‚ÇÅ) T.‚ñ∏ f‚ÇÅ}{(a‚ÇÇ , b‚ÇÇ) T.‚ñ∏ f‚ÇÇ}
    -- {(Œ±‚ÇÄ‚ÇÄ , Œ≤‚ÇÄ‚ÇÄ) T.‚ñ∏ œÜ‚ÇÄ}{(Œ±‚ÇÄ‚ÇÅ , Œ≤‚ÇÄ‚ÇÅ) T.‚ñ∏ œà‚ÇÄ}{(Œ±‚ÇÅ‚ÇÄ , Œ≤‚ÇÅ‚ÇÄ) T.‚ñ∏ œÜ‚ÇÅ}{(Œ±‚ÇÅ‚ÇÅ , Œ≤‚ÇÅ‚ÇÅ) T.‚ñ∏ œà‚ÇÅ}
    (Œπ (Œ¶‚ÇÄ , Œ®‚ÇÄ))(Œπ (Œ¶‚ÇÅ , Œ®‚ÇÅ))
    =
    Œπ (seq‚ÇÄ* A Œ¶‚ÇÄ Œ¶‚ÇÅ , seq‚ÇÄ* B Œ®‚ÇÄ Œ®‚ÇÅ)
  inv‚ÇÄ* (_‚Üì_ {A = A}{B}{V} F G)
    -- {(a‚ÇÄ , b‚ÇÄ) T.‚ñ∏ f‚ÇÄ}{(a‚ÇÅ , b‚ÇÅ) T.‚ñ∏ f‚ÇÅ}
    -- {(Œ±‚ÇÄ , Œ≤‚ÇÄ) T.‚ñ∏ œÜ}{(Œ±‚ÇÅ , Œ≤‚ÇÅ) T.‚ñ∏ œà}
    (Œπ (Œ¶ , Œ®))
    =
    Œπ (inv‚ÇÄ* A Œ¶ , inv‚ÇÄ* B Œ®)
  ‚ä¢idn‚ÇÄ-Œª (_‚Üì_ {A = A}{B}{V} F G)
    -- {(a‚ÇÄ , b‚ÇÄ) T.‚ñ∏ f‚ÇÄ}{(a‚ÇÅ , b‚ÇÅ) T.‚ñ∏ f‚ÇÅ}
    -- {(Œ± , Œ≤) T.‚ñ∏ œÜ}
    =
    Œπ (‚ä¢idn‚ÇÄ-Œª A , ‚ä¢idn‚ÇÄ-Œª B)
  ‚ä¢idn‚ÇÄ-œÅ (_‚Üì_ {A = A}{B}{V} F G)
    -- {(a‚ÇÄ , b‚ÇÄ) T.‚ñ∏ f‚ÇÄ}{(a‚ÇÅ , b‚ÇÅ) T.‚ñ∏ f‚ÇÅ}
    -- {(Œ± , Œ≤) T.‚ñ∏ œÜ}
    =
    Œπ (‚ä¢idn‚ÇÄ-œÅ A , ‚ä¢idn‚ÇÄ-œÅ B)
  ‚ä¢seq‚ÇÄ-Œ± (_‚Üì_ {A = A}{B}{V} F G)
    -- {(a‚ÇÄ , b‚ÇÄ) T.‚ñ∏ f‚ÇÄ}{(a‚ÇÅ , b‚ÇÅ) T.‚ñ∏ f‚ÇÅ}{(a‚ÇÇ , b‚ÇÇ) T.‚ñ∏ f‚ÇÇ}{(a‚ÇÉ , b‚ÇÉ) T.‚ñ∏ f‚ÇÉ}
    -- {(Œ±‚ÇÄ , Œ≤‚ÇÄ) T.‚ñ∏ œÜ‚ÇÄ}{(Œ±‚ÇÅ , Œ≤‚ÇÅ) T.‚ñ∏ œÜ‚ÇÅ}{(Œ±‚ÇÇ , Œ≤‚ÇÇ) T.‚ñ∏ œÜ‚ÇÇ}
    =
    Œπ (‚ä¢seq‚ÇÄ-Œ± A , ‚ä¢seq‚ÇÄ-Œ± B)
  ‚ä¢inv‚ÇÄ-Œª (_‚Üì_ {A = A}{B}{V} F G)
    -- {(a‚ÇÄ , b‚ÇÄ) T.‚ñ∏ f‚ÇÄ}{(a‚ÇÅ , b‚ÇÅ) T.‚ñ∏ f‚ÇÅ}
    -- {(Œ± , Œ≤) T.‚ñ∏ œÜ}
    {‚âú = ‚âú}
    =
    Œπ (‚ä¢inv‚ÇÄ-Œª A {‚âú = ‚âú} , ‚ä¢inv‚ÇÄ-Œª B {‚âú = ‚âú})
  ‚ä¢inv‚ÇÄ-œÅ (_‚Üì_ {A = A}{B}{V} F G)
    -- {(a‚ÇÄ , b‚ÇÄ) T.‚ñ∏ f‚ÇÄ}{(a‚ÇÅ , b‚ÇÅ) T.‚ñ∏ f‚ÇÅ}
    -- {(Œ± , Œ≤) T.‚ñ∏ œÜ}
    {‚âú = ‚âú}
    =
    Œπ (‚ä¢inv‚ÇÄ-œÅ A {‚âú = ‚âú} , ‚ä¢inv‚ÇÄ-œÅ B {‚âú = ‚âú})
  idn‚ÇÅ (_‚Üì_ {A = A}{B}{V} F G)
    -- {(a‚ÇÄ , b‚ÇÄ) T.‚ñ∏ f‚ÇÄ}{(a‚ÇÅ , b‚ÇÅ) T.‚ñ∏ f‚ÇÅ}
    -- {(Œ± , Œ≤) T.‚ñ∏ œÜ}
    =
    Œπ (idn‚ÇÅ A , idn‚ÇÅ B)
  seq‚ÇÅ (_‚Üì_ {A = A}{B}{V} F G)
    -- {(a‚ÇÄ , b‚ÇÄ) T.‚ñ∏ f‚ÇÄ}{(a‚ÇÅ , b‚ÇÅ) T.‚ñ∏ f‚ÇÅ}
    -- {(Œ±‚ÇÄ , Œ≤‚ÇÄ) T.‚ñ∏ œÜ‚ÇÄ}{(Œ±‚ÇÅ , Œ≤‚ÇÅ) T.‚ñ∏ œÜ‚ÇÅ}{(Œ±‚ÇÇ , Œ≤‚ÇÇ) T.‚ñ∏ œÜ‚ÇÇ}
    (Œπ (Œ¶‚ÇÄ , Œ®‚ÇÄ))
    (Œπ (Œ¶‚ÇÅ , Œ®‚ÇÅ))
    =
    Œπ (seq‚ÇÅ A Œ¶‚ÇÄ Œ¶‚ÇÅ , seq‚ÇÅ B Œ®‚ÇÄ Œ®‚ÇÅ)
  inv‚ÇÅ (_‚Üì_ {A = A}{B}{V} F G)
    -- {(a‚ÇÄ , b‚ÇÄ) T.‚ñ∏ f‚ÇÄ}{(a‚ÇÅ , b‚ÇÅ) T.‚ñ∏ f‚ÇÅ}
    -- {(Œ±‚ÇÄ , Œ≤‚ÇÄ) T.‚ñ∏ œÜ‚ÇÄ}{(Œ±‚ÇÅ , Œ≤‚ÇÅ) T.‚ñ∏ œÜ‚ÇÅ}
    (Œπ (Œ¶ , Œ®))
    =
    Œπ (inv‚ÇÅ A Œ¶ , inv‚ÇÅ B Œ®)

open Comma public
  using (_‚Üì_)
